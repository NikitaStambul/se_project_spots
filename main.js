!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitBtnSelector:".modal__btn",errorSelector:".modal__error",inputTypeErrorClass:"modal__input_type_error",errorActiveClass:"modal__error_active",inactiveSubmitBtnClass:"modal__btn_inactive"};function t(e,t,r){Array.from(e).some((e=>!e.validity.valid))?o(t,r):function(e,t){e.classList.remove(t.inactiveSubmitBtnClass),e.disabled=!1}(t,r)}function r(e,t){const r=e.parentElement.querySelector(t.errorSelector);e.classList.remove(t.inputTypeErrorClass),r.classList.remove(t.errorActiveClass)}function o(e,t){e.classList.add(t.inactiveSubmitBtnClass),e.disabled=!0}function n(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Saving...";e.textContent=t?o:r}let a,s;const c=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return this._customFetch(`${this._baseUrl}/cards`,{headers:this._headers})}getUserInfo(){return this._customFetch(`${this._baseUrl}/users/me`,{headers:this._headers})}addPost(e){let{name:t,link:r}=e;return this._customFetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})})}deleteCard(e){return this._customFetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers})}changeLikeStatus(e,t){return this._customFetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers})}editUserInfo(e){let{name:t,about:r}=e;return this._customFetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})})}editUserAvatar(e){return this._customFetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}_customFetch(e,t){return fetch(e,t).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"4775fc00-e1d6-4cc2-859b-b095cced12a0","Content-Type":"application/json"}}),i=document.querySelector(".profile__avatar"),l=document.querySelector("#edit-profile-modal"),d=document.querySelector("#edit-avatar-modal"),u=document.querySelector(".profile__avatar"),m=document.querySelector(".profile__avatar-btn"),_=document.querySelector(".profile__name"),h=document.querySelector(".profile__description"),v=l.querySelector("#profile-name-input"),p=l.querySelector("#profile-description-input"),f=document.querySelector(".profile__edit-btn"),y=document.forms["edit-profile"],b=document.forms["edit-avatar"];m.addEventListener("click",(()=>D(d))),b.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter,{avatar:r}=e.target.elements;n(t,!1),c.editUserAvatar(r.value).then((e=>{u.src=e.avatar,T(d)})).catch((e=>console.error(e))).finally((()=>n(t,!0)))})),f.addEventListener("click",(()=>{[v,p].forEach((t=>r(t,e))),v.value=_.textContent,p.value=h.textContent,D(l)})),y.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter,{name:r,about:o}=e.target.elements;n(t,!1),c.editUserInfo({name:r.value,about:o.value}).then((e=>{_.textContent=e.name,h.textContent=e.about,T(l)})).catch((e=>console.error(e))).finally((()=>n(t,!0)))}));const S=document.querySelector("#new-post-modal"),E=document.querySelector(".profile__add-btn"),q=document.forms["new-post"],L=q.querySelector(".modal__btn");E.addEventListener("click",(()=>D(S))),q.addEventListener("submit",(function(t){t.preventDefault();const r=t.submitter,{name:a,link:s}=t.target.elements;n(r,!0,"Add post","Adding post..."),c.addPost({name:a.value,link:s.value}).then((e=>{const t=F(e);x.prepend(t),T(S)})).catch((e=>console.error(e))).finally((()=>n(saveBtnEl,!1,"Add post","Adding post..."))),t.target.reset(),o(L,e)}));const g=document.querySelector("#delete-post-modal");document.forms["delete-post"].addEventListener("submit",(function(e){const t=e.submitter;e.preventDefault(),n(t,!0,"Delete","Deleting..."),c.deleteCard(s).then((()=>{a.remove(),T(g)})).catch((e=>console.error(e))).finally((()=>n(t,!1,"Delete","Deleting...")))}));const k=document.querySelector("#preview-modal"),C=k.querySelector(".modal__image"),A=k.querySelector(".modal__caption"),U=document.querySelectorAll(".modal"),x=document.querySelector(".cards__list");function D(e){document.addEventListener("keydown",$),e.classList.add("modal_opened")}function T(e){document.removeEventListener("keydown",$),e.classList.remove("modal_opened")}function $(e){"Escape"===e.key&&document.querySelectorAll(".modal_opened").forEach(T)}function F(e){const{_id:t,link:r,name:o,isLiked:n}=e,i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=i.querySelector(".card__title"),d=i.querySelector(".card__image"),u=i.querySelector(".card__like-btn"),m=i.querySelector(".card__delete-btn");return l.textContent=o,d.setAttribute("src",r),d.setAttribute("alt",o+" image"),n&&u.classList.add("card__like-btn_is-liked"),u.addEventListener("click",(()=>{const e=u.classList.contains("card__like-btn_is-liked");c.changeLikeStatus(t,e).then((()=>u.classList.toggle("card__like-btn_is-liked"))).catch((e=>console.error(e)))})),m.addEventListener("click",(()=>{a=i,s=t,D(g)})),d.addEventListener("click",(()=>{C.setAttribute("src",r),C.setAttribute("alt",o+" image"),A.textContent=o,D(k)})),i}var I;I=e,document.querySelectorAll(I.formSelector).forEach((e=>{!function(e,o){const n=e.querySelectorAll(o.inputSelector),a=e.querySelector(o.submitBtnSelector);t(n,a,o),n.forEach((e=>{e.addEventListener("input",(()=>{!function(e,t){e.validity.valid?r(e,t):function(e,t){const r=e.parentElement.querySelector(t.errorSelector);e.classList.add(t.inputTypeErrorClass),r.textContent=e.validationMessage,r.classList.add(t.errorActiveClass)}(e,t)}(e,o),t(n,a,o)}))}))}(e,I)})),document.querySelectorAll(".modal__close-btn").forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>T(t)))})),U.forEach((e=>{e.addEventListener("click",(e=>{e.target.classList.contains("modal_opened")&&T(e.target)}))})),c.getAppInfo().then((e=>{let[t,r]=e;t.forEach((e=>{const t=F(e);x.append(t)})),_.textContent=r.name,h.textContent=r.about,i.src=r.avatar})).catch(console.error)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxTQUFTQyxNQUNuQk0sRUFBZVIsRUFBU0osR0FhNUIsU0FBd0JJLEVBQVNKLEdBQy9CLE1BQU1hLEVBQVVULEVBQVFVLGNBQWNDLGNBQWNmLEVBQU9QLGVBRTNEVyxFQUFRSSxVQUFVUSxJQUFJaEIsRUFBT04scUJBQzdCbUIsRUFBUVksWUFBY3JCLEVBQVFtSSxrQkFDOUIxSCxFQUFRTCxVQUFVUSxJQUFJaEIsRUFBT0wsaUJBQy9CLENBakJJNkksQ0FBZXBJLEVBQVNKLEVBRTVCLENBMUJNeUksQ0FBaUJySSxFQUFTSixHQUMxQkgsRUFBa0JDLEVBQVdDLEVBQVVDLEVBQU8sR0FDOUMsR0FFTixDQWhCSTBJLENBQXFCSixFQUFRdEksRUFBTyxJRXVEakJzRSxTQUFTZ0QsaUJBQWlCLHFCQUVsQ2xCLFNBQVN1QyxJQUNwQixNQUFNcEIsRUFBUW9CLEVBQU9DLFFBQVEsVUFDN0JELEVBQU94RCxpQkFBaUIsU0FBUyxJQUFNVyxFQUFXeUIsSUFBTyxJQUszREYsRUFBT2pCLFNBQVNtQixJQUNkQSxFQUFNcEMsaUJBQWlCLFNBQVVFLElBQzNCQSxFQUFJSSxPQUFPakYsVUFBVTRILFNBQVMsaUJBQ2hDdEMsRUFBV1QsRUFBSUksT0FDakIsR0FDQSxJQTJJSjdELEVBQ0dRLGFBQ0EwQixNQUFLaEMsSUFBdUIsSUFBckIrRyxFQUFPQyxHQUFTaEgsRUFDdEIrRyxFQUFNekMsU0FBU00sSUFDYixNQUFNQyxFQUFTQyxFQUFlRixHQUM5QkcsRUFBU2tDLE9BQU9wQyxFQUFPLElBR3pCaEMsRUFBWWxELFlBQWNxSCxFQUFTbEcsS0FDbkNnQyxFQUFtQm5ELFlBQWNxSCxFQUFTdEYsTUFDMUNhLEVBQWN3QixJQUFNaUQsRUFBU3BGLE1BQU0sSUFFcENxQyxNQUFNRSxRQUFRQyxNIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9oZWxwZXJzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZm9ybVZhbGlkYXRpb25Db25maWcgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ0blNlbGVjdG9yOiBcIi5tb2RhbF9fYnRuXCIsXG4gIGVycm9yU2VsZWN0b3I6IFwiLm1vZGFsX19lcnJvclwiLFxuICBpbnB1dFR5cGVFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQWN0aXZlQ2xhc3M6IFwibW9kYWxfX2Vycm9yX2FjdGl2ZVwiLFxuICBpbmFjdGl2ZVN1Ym1pdEJ0bkNsYXNzOiBcIm1vZGFsX19idG5faW5hY3RpdmVcIixcbn07XG5cbmZ1bmN0aW9uIGVuYWJsZVZhbGlkYXRpb24oY29uZmlnKSB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKTtcblxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWwpID0+IHtcbiAgICBzZXRWYWxpZGF0aW9uT25FdmVudChmb3JtRWwsIGNvbmZpZyk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBzZXRWYWxpZGF0aW9uT25FdmVudChmb3JtRWwsIGNvbmZpZykge1xuICBjb25zdCBpbnB1dExpc3QgPSBmb3JtRWwucXVlcnlTZWxlY3RvckFsbChjb25maWcuaW5wdXRTZWxlY3Rvcik7XG4gIGNvbnN0IGJ1dHRvbkVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ0blNlbGVjdG9yKTtcblxuICB1cGRhdGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XG4gICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgdG9nZ2xlSW5wdXRFcnJvcihpbnB1dEVsLCBjb25maWcpO1xuICAgICAgdXBkYXRlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZykge1xuICBjb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoKCkgPT4ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKGlucHV0TGlzdCkuc29tZSgoaW5wdXRFbCkgPT4ge1xuICAgICAgcmV0dXJuICFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkO1xuICAgIH0pO1xuICB9KSgpO1xuXG4gIGlmIChoYXNJbnZhbGlkSW5wdXQpIHtcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGVuYWJsZUJ1dHRvbihidXR0b25FbCwgY29uZmlnKTtcbiAgfVxufVxuXG5mdW5jdGlvbiB0b2dnbGVJbnB1dEVycm9yKGlucHV0RWwsIGNvbmZpZykge1xuICBpZiAoaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgIGhpZGVJbnB1dEVycm9yKGlucHV0RWwsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgc2hvd0lucHV0RXJyb3IoaW5wdXRFbCwgY29uZmlnKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBoaWRlSW5wdXRFcnJvcihpbnB1dEVsLCBjb25maWcpIHtcbiAgY29uc3QgZXJyb3JFbCA9IGlucHV0RWwucGFyZW50RWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5lcnJvclNlbGVjdG9yKTtcblxuICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmlucHV0VHlwZUVycm9yQ2xhc3MpO1xuICBlcnJvckVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmVycm9yQWN0aXZlQ2xhc3MpO1xufVxuXG5mdW5jdGlvbiBzaG93SW5wdXRFcnJvcihpbnB1dEVsLCBjb25maWcpIHtcbiAgY29uc3QgZXJyb3JFbCA9IGlucHV0RWwucGFyZW50RWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5lcnJvclNlbGVjdG9yKTtcblxuICBpbnB1dEVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmlucHV0VHlwZUVycm9yQ2xhc3MpO1xuICBlcnJvckVsLnRleHRDb250ZW50ID0gaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZTtcbiAgZXJyb3JFbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5lcnJvckFjdGl2ZUNsYXNzKTtcbn1cblxuZnVuY3Rpb24gZGlzYWJsZUJ1dHRvbihidXR0b25FbCwgY29uZmlnKSB7XG4gIGJ1dHRvbkVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlU3VibWl0QnRuQ2xhc3MpO1xuICBidXR0b25FbC5kaXNhYmxlZCA9IHRydWU7XG59XG5cbmZ1bmN0aW9uIGVuYWJsZUJ1dHRvbihidXR0b25FbCwgY29uZmlnKSB7XG4gIGJ1dHRvbkVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlU3VibWl0QnRuQ2xhc3MpO1xuICBidXR0b25FbC5kaXNhYmxlZCA9IGZhbHNlO1xufVxuXG5mdW5jdGlvbiByZXNldFZhbGlkYXRpb24oaW5wdXRMaXN0KSB7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiBoaWRlSW5wdXRFcnJvcihpbnB1dEVsLCBmb3JtVmFsaWRhdGlvbkNvbmZpZykpO1xufVxuXG5leHBvcnQge1xuICBlbmFibGVWYWxpZGF0aW9uLFxuICByZXNldFZhbGlkYXRpb24sXG4gIGRpc2FibGVCdXR0b24sXG4gIGZvcm1WYWxpZGF0aW9uQ29uZmlnLFxufTtcbiIsImV4cG9ydCBmdW5jdGlvbiBzZXRCdG5UZXh0KFxuICBidG4sXG4gIGlzTG9hZGluZyxcbiAgZGVmYXVsdFRleHQgPSBcIlNhdmVcIixcbiAgbG9hZGluZ1RleHQgPSBcIlNhdmluZy4uLlwiXG4pIHtcbiAgaWYgKGlzTG9hZGluZykge1xuICAgIGJ0bi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xuICB9IGVsc2Uge1xuICAgIGJ0bi50ZXh0Q29udGVudCA9IGRlZmF1bHRUZXh0O1xuICB9XG59XG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IHtcbiAgZW5hYmxlVmFsaWRhdGlvbixcbiAgcmVzZXRWYWxpZGF0aW9uLFxuICBkaXNhYmxlQnV0dG9uLFxuICBmb3JtVmFsaWRhdGlvbkNvbmZpZyxcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5pbXBvcnQgeyBzZXRCdG5UZXh0IH0gZnJvbSBcIi4uL3V0aWxzL2hlbHBlcnMuanNcIjtcblxubGV0IHNlbGVjdGVkQ2FyZEVsLCBzZWxlY3RlZENhcmRJZDtcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjQ3NzVmYzAwLWUxZDYtNGNjMi04NTliLWIwOTVjY2VkMTJhMFwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmNvbnN0IGF2YXRhckltYWdlRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcblxuLy8gcHJvZmlsZSBlZGl0XG5jb25zdCBlZGl0UHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtbW9kYWxcIik7XG5jb25zdCBlZGl0QXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtYXZhdGFyLW1vZGFsXCIpO1xuY29uc3QgYXZhdGFyRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXJCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idG5cIik7XG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG5jb25zdCBwcm9maWxlTmFtZUlucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbklucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcbik7XG5jb25zdCBwcm9maWxlRWRpdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idG5cIik7XG5jb25zdCBwcm9maWxlRWRpdEZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImVkaXQtcHJvZmlsZVwiXTtcbmNvbnN0IHByb2ZpbGVBdmF0YXJGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJlZGl0LWF2YXRhclwiXTtcblxucHJvZmlsZUF2YXRhckJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gb3Blbk1vZGFsKGVkaXRBdmF0YXJNb2RhbCkpO1xucHJvZmlsZUF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJGb3JtU3VibWl0KTtcbnByb2ZpbGVFZGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHJlc2V0VmFsaWRhdGlvbihbcHJvZmlsZU5hbWVJbnB1dCwgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXRdKTtcbiAgcHJvZmlsZU5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lLnRleHRDb250ZW50O1xuICBwcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcbiAgb3Blbk1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5wcm9maWxlRWRpdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVFZGl0UHJvZmlsZUZvcm1TdWJtaXQpO1xuXG4vLyBuZXcgcG9zdFxuY29uc3QgbmV3UG9zdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXctcG9zdC1tb2RhbFwiKTtcbmNvbnN0IG5ld1Bvc3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idG5cIik7XG5jb25zdCBuZXdQb3N0Rm9ybSA9IGRvY3VtZW50LmZvcm1zW1wibmV3LXBvc3RcIl07XG5jb25zdCBwb3N0U3VibWl0QnRuID0gbmV3UG9zdEZvcm0ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnRuXCIpO1xuXG5uZXdQb3N0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBvcGVuTW9kYWwobmV3UG9zdE1vZGFsKSk7XG5uZXdQb3N0Rm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZU5ld1Bvc3RTdWJtaXQpO1xuXG4vLyBkZWxldGUgcG9zdFxuY29uc3QgZGVsZXRlUG9zdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtcG9zdC1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZVBvc3RGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJkZWxldGUtcG9zdFwiXTtcbmRlbGV0ZVBvc3RGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUG9zdERlbGV0ZSk7XG5cbi8vIHByZXZpZXdcbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcbmNvbnN0IHByZXZpZXdJbWFnZUVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgY2FwdGlvbkVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG5cbmNvbnN0IG1vZGFscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIik7XG5jb25zdCBjYXJkTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbmZ1bmN0aW9uIHNldE1vZGFsQ2xvc2VCdG5MaXN0ZW5lcnMoKSB7XG4gIGNvbnN0IGNsb3NlQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcblxuICBjbG9zZUJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XG4gICAgY29uc3QgbW9kYWwgPSBidXR0b24uY2xvc2VzdChcIi5tb2RhbFwiKTtcbiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwobW9kYWwpKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHNldE1vZGFsT3ZlcmxheUNsb3NlTGlzdGVuZXJzKCkge1xuICBtb2RhbHMuZm9yRWFjaCgobW9kYWwpID0+IHtcbiAgICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfb3BlbmVkXCIpKSB7XG4gICAgICAgIGNsb3NlTW9kYWwoZXZ0LnRhcmdldCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY2xvc2VNb2RhbE9uRXNjYXBlKTtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5lZFwiKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBjbG9zZU1vZGFsT25Fc2NhcGUpO1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xufVxuXG5mdW5jdGlvbiBjbG9zZU1vZGFsT25Fc2NhcGUoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3QgbW9kYWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9vcGVuZWRcIik7XG4gICAgbW9kYWxzLmZvckVhY2goY2xvc2VNb2RhbCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHNhdmVCdG5FbCA9IGV2dC5zdWJtaXR0ZXI7XG4gIGNvbnN0IHsgYXZhdGFyIH0gPSBldnQudGFyZ2V0LmVsZW1lbnRzO1xuXG4gIHNldEJ0blRleHQoc2F2ZUJ0bkVsLCBmYWxzZSk7XG4gIGFwaVxuICAgIC5lZGl0VXNlckF2YXRhcihhdmF0YXIudmFsdWUpXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIGF2YXRhckVsLnNyYyA9IGRhdGEuYXZhdGFyO1xuICAgICAgY2xvc2VNb2RhbChlZGl0QXZhdGFyTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiBzZXRCdG5UZXh0KHNhdmVCdG5FbCwgdHJ1ZSkpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVFZGl0UHJvZmlsZUZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzYXZlQnRuRWwgPSBldnQuc3VibWl0dGVyO1xuICBjb25zdCB7IG5hbWUsIGFib3V0IH0gPSBldnQudGFyZ2V0LmVsZW1lbnRzO1xuXG4gIHNldEJ0blRleHQoc2F2ZUJ0bkVsLCBmYWxzZSk7XG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oe1xuICAgICAgbmFtZTogbmFtZS52YWx1ZSxcbiAgICAgIGFib3V0OiBhYm91dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiBzZXRCdG5UZXh0KHNhdmVCdG5FbCwgdHJ1ZSkpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVOZXdQb3N0U3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3QgYWRkUG9zdEJ0bkVsID0gZXZ0LnN1Ym1pdHRlcjtcbiAgY29uc3QgeyBuYW1lLCBsaW5rIH0gPSBldnQudGFyZ2V0LmVsZW1lbnRzO1xuXG4gIHNldEJ0blRleHQoYWRkUG9zdEJ0bkVsLCB0cnVlLCBcIkFkZCBwb3N0XCIsIFwiQWRkaW5nIHBvc3QuLi5cIik7XG4gIGFwaVxuICAgIC5hZGRQb3N0KHtcbiAgICAgIG5hbWU6IG5hbWUudmFsdWUsXG4gICAgICBsaW5rOiBsaW5rLnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGNhcmREYXRhKSA9PiB7XG4gICAgICBjb25zdCBjYXJkRWwgPSBnZXRDYXJkRWxlbWVudChjYXJkRGF0YSk7XG4gICAgICBjYXJkTGlzdC5wcmVwZW5kKGNhcmRFbCk7XG4gICAgICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKVxuICAgIC5maW5hbGx5KCgpID0+IHNldEJ0blRleHQoc2F2ZUJ0bkVsLCBmYWxzZSwgXCJBZGQgcG9zdFwiLCBcIkFkZGluZyBwb3N0Li4uXCIpKTtcblxuICBldnQudGFyZ2V0LnJlc2V0KCk7XG4gIGRpc2FibGVCdXR0b24ocG9zdFN1Ym1pdEJ0biwgZm9ybVZhbGlkYXRpb25Db25maWcpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVQb3N0RGVsZXRlKGV2dCkge1xuICBjb25zdCBzdWJtaXREZWxldGVCdG4gPSBldnQuc3VibWl0dGVyO1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBzZXRCdG5UZXh0KHN1Ym1pdERlbGV0ZUJ0biwgdHJ1ZSwgXCJEZWxldGVcIiwgXCJEZWxldGluZy4uLlwiKTtcbiAgYXBpXG4gICAgLmRlbGV0ZUNhcmQoc2VsZWN0ZWRDYXJkSWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgc2VsZWN0ZWRDYXJkRWwucmVtb3ZlKCk7XG4gICAgICBjbG9zZU1vZGFsKGRlbGV0ZVBvc3RNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKVxuICAgIC5maW5hbGx5KCgpID0+IHNldEJ0blRleHQoc3VibWl0RGVsZXRlQnRuLCBmYWxzZSwgXCJEZWxldGVcIiwgXCJEZWxldGluZy4uLlwiKSk7XG59XG5cbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGNhcmREYXRhKSB7XG4gIGNvbnN0IHsgX2lkOiBpZCwgbGluaywgbmFtZSwgaXNMaWtlZCB9ID0gY2FyZERhdGE7XG4gIGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY29udGVudFxuICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcbiAgICAuY2xvbmVOb2RlKHRydWUpO1xuXG4gIGNvbnN0IGNhcmROYW1lRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2VFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gIGNvbnN0IGNhcmRMaWtlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ0blwiKTtcbiAgY29uc3QgY2FyZERlbGV0ZUJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ0blwiKTtcbiAgY2FyZE5hbWVFbC50ZXh0Q29udGVudCA9IG5hbWU7XG4gIGNhcmRJbWFnZUVsLnNldEF0dHJpYnV0ZShcInNyY1wiLCBsaW5rKTtcbiAgY2FyZEltYWdlRWwuc2V0QXR0cmlidXRlKFwiYWx0XCIsIG5hbWUgKyBcIiBpbWFnZVwiKTtcblxuICBpZiAoaXNMaWtlZCkge1xuICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ0bl9pcy1saWtlZFwiKTtcbiAgfVxuXG4gIGNhcmRMaWtlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc3QgaXNMaWtlZCA9IGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnRuX2lzLWxpa2VkXCIpO1xuICAgIGFwaVxuICAgICAgLmNoYW5nZUxpa2VTdGF0dXMoaWQsIGlzTGlrZWQpXG4gICAgICAudGhlbigoKSA9PiBjYXJkTGlrZUJ0bi5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idG5faXMtbGlrZWRcIikpXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKTtcbiAgfSk7XG4gIGNhcmREZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBzZWxlY3RlZENhcmRFbCA9IGNhcmRFbGVtZW50O1xuICAgIHNlbGVjdGVkQ2FyZElkID0gaWQ7XG5cbiAgICBvcGVuTW9kYWwoZGVsZXRlUG9zdE1vZGFsKTtcbiAgfSk7XG4gIGNhcmRJbWFnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgcHJldmlld0ltYWdlRWwuc2V0QXR0cmlidXRlKFwic3JjXCIsIGxpbmspO1xuICAgIHByZXZpZXdJbWFnZUVsLnNldEF0dHJpYnV0ZShcImFsdFwiLCBuYW1lICsgXCIgaW1hZ2VcIik7XG4gICAgY2FwdGlvbkVsLnRleHRDb250ZW50ID0gbmFtZTtcblxuICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xuICB9KTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbmZ1bmN0aW9uIGluaXRpYWxGZXRjaCgpIHtcbiAgYXBpXG4gICAgLmdldEFwcEluZm8oKVxuICAgIC50aGVuKChbY2FyZHMsIHVzZXJJbmZvXSkgPT4ge1xuICAgICAgY2FyZHMuZm9yRWFjaCgoY2FyZERhdGEpID0+IHtcbiAgICAgICAgY29uc3QgY2FyZEVsID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZERhdGEpO1xuICAgICAgICBjYXJkTGlzdC5hcHBlbmQoY2FyZEVsKTtcbiAgICAgIH0pO1xuXG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXJJbmZvLm5hbWU7XG4gICAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSB1c2VySW5mby5hYm91dDtcbiAgICAgIGF2YXRhckltYWdlRWwuc3JjID0gdXNlckluZm8uYXZhdGFyO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xufVxuXG5lbmFibGVWYWxpZGF0aW9uKGZvcm1WYWxpZGF0aW9uQ29uZmlnKTtcbnNldE1vZGFsQ2xvc2VCdG5MaXN0ZW5lcnMoKTtcbnNldE1vZGFsT3ZlcmxheUNsb3NlTGlzdGVuZXJzKCk7XG5pbml0aWFsRmV0Y2goKTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB0aGlzLl9jdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSk7XG4gIH1cblxuICBhZGRQb3N0KHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICB9XG5cbiAgY2hhbmdlTGlrZVN0YXR1cyhpZCwgaXNMaWtlZCkge1xuICAgIHJldHVybiB0aGlzLl9jdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGFib3V0LFxuICAgICAgfSksXG4gICAgfSk7XG4gIH1cblxuICBlZGl0VXNlckF2YXRhcihhdmF0YXIpIHtcbiAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIF9jdXN0b21GZXRjaCh1cmwsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4gZmV0Y2godXJsLCBvcHRpb25zKS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbImZvcm1WYWxpZGF0aW9uQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ0blNlbGVjdG9yIiwiZXJyb3JTZWxlY3RvciIsImlucHV0VHlwZUVycm9yQ2xhc3MiLCJlcnJvckFjdGl2ZUNsYXNzIiwiaW5hY3RpdmVTdWJtaXRCdG5DbGFzcyIsInVwZGF0ZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWwiLCJjb25maWciLCJBcnJheSIsImZyb20iLCJzb21lIiwiaW5wdXRFbCIsInZhbGlkaXR5IiwidmFsaWQiLCJkaXNhYmxlQnV0dG9uIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiZGlzYWJsZWQiLCJlbmFibGVCdXR0b24iLCJoaWRlSW5wdXRFcnJvciIsImVycm9yRWwiLCJwYXJlbnRFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImFkZCIsInNldEJ0blRleHQiLCJidG4iLCJpc0xvYWRpbmciLCJkZWZhdWx0VGV4dCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImxvYWRpbmdUZXh0IiwidGV4dENvbnRlbnQiLCJzZWxlY3RlZENhcmRFbCIsInNlbGVjdGVkQ2FyZElkIiwiYXBpIiwiY29uc3RydWN0b3IiLCJfcmVmIiwiYmFzZVVybCIsImhlYWRlcnMiLCJ0aGlzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsImdldEFwcEluZm8iLCJQcm9taXNlIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiZ2V0VXNlckluZm8iLCJfY3VzdG9tRmV0Y2giLCJhZGRQb3N0IiwiX3JlZjIiLCJuYW1lIiwibGluayIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZGVsZXRlQ2FyZCIsImlkIiwiY2hhbmdlTGlrZVN0YXR1cyIsImlzTGlrZWQiLCJlZGl0VXNlckluZm8iLCJfcmVmMyIsImFib3V0IiwiZWRpdFVzZXJBdmF0YXIiLCJhdmF0YXIiLCJ1cmwiLCJvcHRpb25zIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwicmVqZWN0Iiwic3RhdHVzIiwiYXV0aG9yaXphdGlvbiIsImF2YXRhckltYWdlRWwiLCJkb2N1bWVudCIsImVkaXRQcm9maWxlTW9kYWwiLCJlZGl0QXZhdGFyTW9kYWwiLCJhdmF0YXJFbCIsInByb2ZpbGVBdmF0YXJCdG4iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsInByb2ZpbGVOYW1lSW5wdXQiLCJwcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsInByb2ZpbGVFZGl0QnRuIiwicHJvZmlsZUVkaXRGb3JtIiwiZm9ybXMiLCJwcm9maWxlQXZhdGFyRm9ybSIsImFkZEV2ZW50TGlzdGVuZXIiLCJvcGVuTW9kYWwiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsInNhdmVCdG5FbCIsInN1Ym1pdHRlciIsInRhcmdldCIsImVsZW1lbnRzIiwidmFsdWUiLCJkYXRhIiwic3JjIiwiY2xvc2VNb2RhbCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZmluYWxseSIsImZvckVhY2giLCJuZXdQb3N0TW9kYWwiLCJuZXdQb3N0QnRuIiwibmV3UG9zdEZvcm0iLCJwb3N0U3VibWl0QnRuIiwiYWRkUG9zdEJ0bkVsIiwiY2FyZERhdGEiLCJjYXJkRWwiLCJnZXRDYXJkRWxlbWVudCIsImNhcmRMaXN0IiwicHJlcGVuZCIsInJlc2V0IiwiZGVsZXRlUG9zdE1vZGFsIiwic3VibWl0RGVsZXRlQnRuIiwicHJldmlld01vZGFsIiwicHJldmlld0ltYWdlRWwiLCJjYXB0aW9uRWwiLCJtb2RhbHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwibW9kYWwiLCJjbG9zZU1vZGFsT25Fc2NhcGUiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwia2V5IiwiX2lkIiwiY2FyZEVsZW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiY2FyZE5hbWVFbCIsImNhcmRJbWFnZUVsIiwiY2FyZExpa2VCdG4iLCJjYXJkRGVsZXRlQnRuIiwic2V0QXR0cmlidXRlIiwiY29udGFpbnMiLCJ0b2dnbGUiLCJmb3JtRWwiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsInNob3dJbnB1dEVycm9yIiwidG9nZ2xlSW5wdXRFcnJvciIsInNldFZhbGlkYXRpb25PbkV2ZW50IiwiYnV0dG9uIiwiY2xvc2VzdCIsImNhcmRzIiwidXNlckluZm8iLCJhcHBlbmQiXSwic291cmNlUm9vdCI6IiJ9