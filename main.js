!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitBtnSelector:".modal__btn",errorSelector:".modal__error",inputTypeErrorClass:"modal__input_type_error",errorActiveClass:"modal__error_active",inactiveSubmitBtnClass:"modal__btn_inactive"};function t(e,t,r){Array.from(e).some((e=>!e.validity.valid))?n(t,r):function(e,t){e.classList.remove(t.inactiveSubmitBtnClass),e.disabled=!1}(t,r)}function r(e,t){const r=e.parentElement.querySelector(t.errorSelector);e.classList.remove(t.inputTypeErrorClass),r.classList.remove(t.errorActiveClass)}function n(e,t){e.classList.add(t.inactiveSubmitBtnClass),e.disabled=!0}function o(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Saving...";e.textContent=t?n:r}let a,s;const c=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return this._customFetch(`${this._baseUrl}/cards`,{headers:this._headers})}getUserInfo(){return this._customFetch(`${this._baseUrl}/users/me`,{headers:this._headers})}addPost(e){let{name:t,link:r}=e;return this._customFetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})})}deleteCard(e){return this._customFetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers})}changeLikeStatus(e,t){return this._customFetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers})}editUserInfo(e){let{name:t,about:r}=e;return this._customFetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})})}editUserAvatar(e){return this._customFetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}_customFetch(e,t){return fetch(e,t).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"4775fc00-e1d6-4cc2-859b-b095cced12a0","Content-Type":"application/json"}}),i=document.querySelector(".profile__avatar"),l=document.querySelector("#edit-profile-modal"),d=document.querySelector("#edit-avatar-modal"),u=document.querySelector(".profile__avatar"),m=document.querySelector(".profile__avatar-btn"),_=document.querySelector(".profile__name"),h=document.querySelector(".profile__description"),v=l.querySelector("#profile-name-input"),p=l.querySelector("#profile-description-input"),f=document.querySelector(".profile__edit-btn"),y=document.forms["edit-profile"],b=document.forms["edit-avatar"];m.addEventListener("click",(()=>T(d))),b.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter,{avatar:r}=e.target.elements;o(t,!0),c.editUserAvatar(r.value).then((e=>{u.src=e.avatar,$(d)})).catch((e=>console.error(e))).finally((()=>o(t,!1)))})),f.addEventListener("click",(()=>{[v,p].forEach((t=>r(t,e))),v.value=_.textContent,p.value=h.textContent,T(l)})),y.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter,{name:r,about:n}=e.target.elements;o(t,!0),c.editUserInfo({name:r.value,about:n.value}).then((e=>{_.textContent=e.name,h.textContent=e.about,$(l)})).catch((e=>console.error(e))).finally((()=>o(t,!1)))}));const S=document.querySelector("#new-post-modal"),E=document.querySelector(".profile__add-btn"),q=document.forms["new-post"],L=q.querySelector(".modal__btn");E.addEventListener("click",(()=>T(S))),q.addEventListener("submit",(function(t){t.preventDefault();const r=t.submitter,{name:a,link:s}=t.target.elements;o(r,!0,"Add post","Adding post..."),c.addPost({name:a.value,link:s.value}).then((r=>{const o=I(r);D.prepend(o),$(S),t.target.reset(),n(L,e)})).catch((e=>console.error(e))).finally((()=>o(r,!1,"Add post","Adding post...")))}));const g=document.querySelector("#delete-post-modal"),k=document.forms["delete-post"];document.querySelector(".modal__btn_cancel").addEventListener("click",(()=>$(g))),k.addEventListener("submit",(function(e){const t=e.submitter;e.preventDefault(),o(t,!0,"Delete","Deleting..."),c.deleteCard(s).then((()=>{a.remove(),$(g)})).catch((e=>console.error(e))).finally((()=>o(t,!1,"Delete","Deleting...")))}));const C=document.querySelector("#preview-modal"),A=C.querySelector(".modal__image"),U=C.querySelector(".modal__caption"),x=document.querySelectorAll(".modal"),D=document.querySelector(".cards__list");function T(e){document.addEventListener("keydown",F),e.classList.add("modal_opened")}function $(e){document.removeEventListener("keydown",F),e.classList.remove("modal_opened")}function F(e){"Escape"===e.key&&document.querySelectorAll(".modal_opened").forEach($)}function I(e){const{_id:t,link:r,name:n,isLiked:o}=e,i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=i.querySelector(".card__title"),d=i.querySelector(".card__image"),u=i.querySelector(".card__like-btn"),m=i.querySelector(".card__delete-btn");return l.textContent=n,d.setAttribute("src",r),d.setAttribute("alt",n+" image"),o&&u.classList.add("card__like-btn_is-liked"),u.addEventListener("click",(()=>{const e=u.classList.contains("card__like-btn_is-liked");c.changeLikeStatus(t,e).then((()=>u.classList.toggle("card__like-btn_is-liked"))).catch((e=>console.error(e)))})),m.addEventListener("click",(()=>{a=i,s=t,T(g)})),d.addEventListener("click",(()=>{A.setAttribute("src",r),A.setAttribute("alt",n+" image"),U.textContent=n,T(C)})),i}var P;P=e,document.querySelectorAll(P.formSelector).forEach((e=>{!function(e,n){const o=e.querySelectorAll(n.inputSelector),a=e.querySelector(n.submitBtnSelector);t(o,a,n),o.forEach((e=>{e.addEventListener("input",(()=>{!function(e,t){e.validity.valid?r(e,t):function(e,t){const r=e.parentElement.querySelector(t.errorSelector);e.classList.add(t.inputTypeErrorClass),r.textContent=e.validationMessage,r.classList.add(t.errorActiveClass)}(e,t)}(e,n),t(o,a,n)}))}))}(e,P)})),document.querySelectorAll(".modal__close-btn").forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>$(t)))})),x.forEach((e=>{e.addEventListener("click",(e=>{e.target.classList.contains("modal_opened")&&$(e.target)}))})),c.getAppInfo().then((e=>{let[t,r]=e;t.forEach((e=>{const t=I(e);D.append(t)})),_.textContent=r.name,h.textContent=r.about,i.src=r.avatar})).catch(console.error)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBmb3JtVmFsaWRhdGlvbkNvbmZpZyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnRuU2VsZWN0b3I6IFwiLm1vZGFsX19idG5cIixcbiAgZXJyb3JTZWxlY3RvcjogXCIubW9kYWxfX2Vycm9yXCIsXG4gIGlucHV0VHlwZUVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JBY3RpdmVDbGFzczogXCJtb2RhbF9fZXJyb3JfYWN0aXZlXCIsXG4gIGluYWN0aXZlU3VibWl0QnRuQ2xhc3M6IFwibW9kYWxfX2J0bl9pbmFjdGl2ZVwiLFxufTtcblxuZnVuY3Rpb24gZW5hYmxlVmFsaWRhdGlvbihjb25maWcpIHtcbiAgY29uc3QgZm9ybUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpO1xuXG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbCkgPT4ge1xuICAgIHNldFZhbGlkYXRpb25PbkV2ZW50KGZvcm1FbCwgY29uZmlnKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHNldFZhbGlkYXRpb25PbkV2ZW50KGZvcm1FbCwgY29uZmlnKSB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKTtcbiAgY29uc3QgYnV0dG9uRWwgPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnRuU2VsZWN0b3IpO1xuXG4gIHVwZGF0ZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZyk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWwpID0+IHtcbiAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICB0b2dnbGVJbnB1dEVycm9yKGlucHV0RWwsIGNvbmZpZyk7XG4gICAgICB1cGRhdGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKSB7XG4gIGNvbnN0IGhhc0ludmFsaWRJbnB1dCA9ICgoKSA9PiB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20oaW5wdXRMaXN0KS5zb21lKChpbnB1dEVsKSA9PiB7XG4gICAgICByZXR1cm4gIWlucHV0RWwudmFsaWRpdHkudmFsaWQ7XG4gICAgfSk7XG4gIH0pKCk7XG5cbiAgaWYgKGhhc0ludmFsaWRJbnB1dCkge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWwsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgZW5hYmxlQnV0dG9uKGJ1dHRvbkVsLCBjb25maWcpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHRvZ2dsZUlucHV0RXJyb3IoaW5wdXRFbCwgY29uZmlnKSB7XG4gIGlmIChpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgaGlkZUlucHV0RXJyb3IoaW5wdXRFbCwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBzaG93SW5wdXRFcnJvcihpbnB1dEVsLCBjb25maWcpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGhpZGVJbnB1dEVycm9yKGlucHV0RWwsIGNvbmZpZykge1xuICBjb25zdCBlcnJvckVsID0gaW5wdXRFbC5wYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLmVycm9yU2VsZWN0b3IpO1xuXG4gIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRUeXBlRXJyb3JDbGFzcyk7XG4gIGVycm9yRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuZXJyb3JBY3RpdmVDbGFzcyk7XG59XG5cbmZ1bmN0aW9uIHNob3dJbnB1dEVycm9yKGlucHV0RWwsIGNvbmZpZykge1xuICBjb25zdCBlcnJvckVsID0gaW5wdXRFbC5wYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLmVycm9yU2VsZWN0b3IpO1xuXG4gIGlucHV0RWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRUeXBlRXJyb3JDbGFzcyk7XG4gIGVycm9yRWwudGV4dENvbnRlbnQgPSBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlO1xuICBlcnJvckVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmVycm9yQWN0aXZlQ2xhc3MpO1xufVxuXG5mdW5jdGlvbiBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsLCBjb25maWcpIHtcbiAgYnV0dG9uRWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5hY3RpdmVTdWJtaXRCdG5DbGFzcyk7XG4gIGJ1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gZW5hYmxlQnV0dG9uKGJ1dHRvbkVsLCBjb25maWcpIHtcbiAgYnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVTdWJtaXRCdG5DbGFzcyk7XG4gIGJ1dHRvbkVsLmRpc2FibGVkID0gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIHJlc2V0VmFsaWRhdGlvbihpbnB1dExpc3QpIHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWwpID0+IGhpZGVJbnB1dEVycm9yKGlucHV0RWwsIGZvcm1WYWxpZGF0aW9uQ29uZmlnKSk7XG59XG5cbmV4cG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHJlc2V0VmFsaWRhdGlvbixcbiAgZGlzYWJsZUJ1dHRvbixcbiAgZm9ybVZhbGlkYXRpb25Db25maWcsXG59O1xuIiwiZXhwb3J0IGZ1bmN0aW9uIHNldEJ0blRleHQoXG4gIGJ0bixcbiAgaXNMb2FkaW5nLFxuICBkZWZhdWx0VGV4dCA9IFwiU2F2ZVwiLFxuICBsb2FkaW5nVGV4dCA9IFwiU2F2aW5nLi4uXCJcbikge1xuICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgYnRuLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XG4gIH0gZWxzZSB7XG4gICAgYnRuLnRleHRDb250ZW50ID0gZGVmYXVsdFRleHQ7XG4gIH1cbn1cbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQge1xuICBlbmFibGVWYWxpZGF0aW9uLFxuICByZXNldFZhbGlkYXRpb24sXG4gIGRpc2FibGVCdXR0b24sXG4gIGZvcm1WYWxpZGF0aW9uQ29uZmlnLFxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcbmltcG9ydCB7IHNldEJ0blRleHQgfSBmcm9tIFwiLi4vdXRpbHMvaGVscGVycy5qc1wiO1xuXG5sZXQgc2VsZWN0ZWRDYXJkRWwsIHNlbGVjdGVkQ2FyZElkO1xuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiNDc3NWZjMDAtZTFkNi00Y2MyLTg1OWItYjA5NWNjZWQxMmEwXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuY29uc3QgYXZhdGFySW1hZ2VFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuXG4vLyBwcm9maWxlIGVkaXRcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IGVkaXRBdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuY29uc3QgcHJvZmlsZUF2YXRhckJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ0blwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1uYW1lLWlucHV0XCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcbmNvbnN0IHByb2ZpbGVFZGl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcbmNvbnN0IHByb2ZpbGVFZGl0Rm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiZWRpdC1wcm9maWxlXCJdO1xuY29uc3QgcHJvZmlsZUF2YXRhckZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImVkaXQtYXZhdGFyXCJdO1xuXG5wcm9maWxlQXZhdGFyQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBvcGVuTW9kYWwoZWRpdEF2YXRhck1vZGFsKSk7XG5wcm9maWxlQXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQpO1xucHJvZmlsZUVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgcmVzZXRWYWxpZGF0aW9uKFtwcm9maWxlTmFtZUlucHV0LCBwcm9maWxlRGVzY3JpcHRpb25JbnB1dF0pO1xuICBwcm9maWxlTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XG4gIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50O1xuICBvcGVuTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG59KTtcbnByb2ZpbGVFZGl0Rm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRQcm9maWxlRm9ybVN1Ym1pdCk7XG5cbi8vIG5ldyBwb3N0XG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xuY29uc3QgbmV3UG9zdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ0blwiKTtcbmNvbnN0IG5ld1Bvc3RGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJuZXctcG9zdFwiXTtcbmNvbnN0IHBvc3RTdWJtaXRCdG4gPSBuZXdQb3N0Rm9ybS5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idG5cIik7XG5cbm5ld1Bvc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IG9wZW5Nb2RhbChuZXdQb3N0TW9kYWwpKTtcbm5ld1Bvc3RGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlTmV3UG9zdFN1Ym1pdCk7XG5cbi8vIGRlbGV0ZSBwb3N0XG5jb25zdCBkZWxldGVQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1wb3N0LW1vZGFsXCIpO1xuY29uc3QgZGVsZXRlUG9zdEZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImRlbGV0ZS1wb3N0XCJdO1xuY29uc3QgZGVsZXRlUG9zdENhbmNlbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J0bl9jYW5jZWxcIik7XG5kZWxldGVQb3N0Q2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICBjbG9zZU1vZGFsKGRlbGV0ZVBvc3RNb2RhbClcbik7XG5kZWxldGVQb3N0Rm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZVBvc3REZWxldGUpO1xuXG4vLyBwcmV2aWV3XG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XG5jb25zdCBwcmV2aWV3SW1hZ2VFbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbmNvbnN0IGNhcHRpb25FbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG5jb25zdCBtb2RhbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsXCIpO1xuY29uc3QgY2FyZExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xuXG5mdW5jdGlvbiBzZXRNb2RhbENsb3NlQnRuTGlzdGVuZXJzKCkge1xuICBjb25zdCBjbG9zZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5cbiAgY2xvc2VCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgIGNvbnN0IG1vZGFsID0gYnV0dG9uLmNsb3Nlc3QoXCIubW9kYWxcIik7XG4gICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZU1vZGFsKG1vZGFsKSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBzZXRNb2RhbE92ZXJsYXlDbG9zZUxpc3RlbmVycygpIHtcbiAgbW9kYWxzLmZvckVhY2goKG1vZGFsKSA9PiB7XG4gICAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX29wZW5lZFwiKSkge1xuICAgICAgICBjbG9zZU1vZGFsKGV2dC50YXJnZXQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNsb3NlTW9kYWxPbkVzY2FwZSk7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY2xvc2VNb2RhbE9uRXNjYXBlKTtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbE9uRXNjYXBlKGV2dCkge1xuICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgIGNvbnN0IG1vZGFscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfb3BlbmVkXCIpO1xuICAgIG1vZGFscy5mb3JFYWNoKGNsb3NlTW9kYWwpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzYXZlQnRuRWwgPSBldnQuc3VibWl0dGVyO1xuICBjb25zdCB7IGF2YXRhciB9ID0gZXZ0LnRhcmdldC5lbGVtZW50cztcblxuICBzZXRCdG5UZXh0KHNhdmVCdG5FbCwgdHJ1ZSk7XG4gIGFwaVxuICAgIC5lZGl0VXNlckF2YXRhcihhdmF0YXIudmFsdWUpXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIGF2YXRhckVsLnNyYyA9IGRhdGEuYXZhdGFyO1xuICAgICAgY2xvc2VNb2RhbChlZGl0QXZhdGFyTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiBzZXRCdG5UZXh0KHNhdmVCdG5FbCwgZmFsc2UpKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRWRpdFByb2ZpbGVGb3JtU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3Qgc2F2ZUJ0bkVsID0gZXZ0LnN1Ym1pdHRlcjtcbiAgY29uc3QgeyBuYW1lLCBhYm91dCB9ID0gZXZ0LnRhcmdldC5lbGVtZW50cztcblxuICBzZXRCdG5UZXh0KHNhdmVCdG5FbCwgdHJ1ZSk7XG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oe1xuICAgICAgbmFtZTogbmFtZS52YWx1ZSxcbiAgICAgIGFib3V0OiBhYm91dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiBzZXRCdG5UZXh0KHNhdmVCdG5FbCwgZmFsc2UpKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlTmV3UG9zdFN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IGFkZFBvc3RCdG5FbCA9IGV2dC5zdWJtaXR0ZXI7XG4gIGNvbnN0IHsgbmFtZSwgbGluayB9ID0gZXZ0LnRhcmdldC5lbGVtZW50cztcblxuICBzZXRCdG5UZXh0KGFkZFBvc3RCdG5FbCwgdHJ1ZSwgXCJBZGQgcG9zdFwiLCBcIkFkZGluZyBwb3N0Li4uXCIpO1xuICBhcGlcbiAgICAuYWRkUG9zdCh7XG4gICAgICBuYW1lOiBuYW1lLnZhbHVlLFxuICAgICAgbGluazogbGluay52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChjYXJkRGF0YSkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZERhdGEpO1xuICAgICAgY2FyZExpc3QucHJlcGVuZChjYXJkRWwpO1xuICAgICAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgICAgZGlzYWJsZUJ1dHRvbihwb3N0U3VibWl0QnRuLCBmb3JtVmFsaWRhdGlvbkNvbmZpZyk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKVxuICAgIC5maW5hbGx5KCgpID0+XG4gICAgICBzZXRCdG5UZXh0KGFkZFBvc3RCdG5FbCwgZmFsc2UsIFwiQWRkIHBvc3RcIiwgXCJBZGRpbmcgcG9zdC4uLlwiKVxuICAgICk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVBvc3REZWxldGUoZXZ0KSB7XG4gIGNvbnN0IHN1Ym1pdERlbGV0ZUJ0biA9IGV2dC5zdWJtaXR0ZXI7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIHNldEJ0blRleHQoc3VibWl0RGVsZXRlQnRuLCB0cnVlLCBcIkRlbGV0ZVwiLCBcIkRlbGV0aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBzZWxlY3RlZENhcmRFbC5yZW1vdmUoKTtcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlUG9zdE1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpXG4gICAgLmZpbmFsbHkoKCkgPT4gc2V0QnRuVGV4dChzdWJtaXREZWxldGVCdG4sIGZhbHNlLCBcIkRlbGV0ZVwiLCBcIkRlbGV0aW5nLi4uXCIpKTtcbn1cblxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoY2FyZERhdGEpIHtcbiAgY29uc3QgeyBfaWQ6IGlkLCBsaW5rLCBuYW1lLCBpc0xpa2VkIH0gPSBjYXJkRGF0YTtcbiAgY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpO1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jb250ZW50XG4gICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxuICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgY29uc3QgY2FyZE5hbWVFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gIGNvbnN0IGNhcmRJbWFnZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuICBjb25zdCBjYXJkRGVsZXRlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnRuXCIpO1xuICBjYXJkTmFtZUVsLnRleHRDb250ZW50ID0gbmFtZTtcbiAgY2FyZEltYWdlRWwuc2V0QXR0cmlidXRlKFwic3JjXCIsIGxpbmspO1xuICBjYXJkSW1hZ2VFbC5zZXRBdHRyaWJ1dGUoXCJhbHRcIiwgbmFtZSArIFwiIGltYWdlXCIpO1xuXG4gIGlmIChpc0xpa2VkKSB7XG4gICAgY2FyZExpa2VCdG4uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnRuX2lzLWxpa2VkXCIpO1xuICB9XG5cbiAgY2FyZExpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBpc0xpa2VkID0gY2FyZExpa2VCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fbGlrZS1idG5faXMtbGlrZWRcIik7XG4gICAgYXBpXG4gICAgICAuY2hhbmdlTGlrZVN0YXR1cyhpZCwgaXNMaWtlZClcbiAgICAgIC50aGVuKCgpID0+IGNhcmRMaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ0bl9pcy1saWtlZFwiKSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xuICB9KTtcbiAgY2FyZERlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHNlbGVjdGVkQ2FyZEVsID0gY2FyZEVsZW1lbnQ7XG4gICAgc2VsZWN0ZWRDYXJkSWQgPSBpZDtcblxuICAgIG9wZW5Nb2RhbChkZWxldGVQb3N0TW9kYWwpO1xuICB9KTtcbiAgY2FyZEltYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBwcmV2aWV3SW1hZ2VFbC5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgbGluayk7XG4gICAgcHJldmlld0ltYWdlRWwuc2V0QXR0cmlidXRlKFwiYWx0XCIsIG5hbWUgKyBcIiBpbWFnZVwiKTtcbiAgICBjYXB0aW9uRWwudGV4dENvbnRlbnQgPSBuYW1lO1xuXG4gICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbCk7XG4gIH0pO1xuXG4gIHJldHVybiBjYXJkRWxlbWVudDtcbn1cblxuZnVuY3Rpb24gZ2V0SW5pdGlhbERhdGEoKSB7XG4gIGFwaVxuICAgIC5nZXRBcHBJbmZvKClcbiAgICAudGhlbigoW2NhcmRzLCB1c2VySW5mb10pID0+IHtcbiAgICAgIGNhcmRzLmZvckVhY2goKGNhcmREYXRhKSA9PiB7XG4gICAgICAgIGNvbnN0IGNhcmRFbCA9IGdldENhcmRFbGVtZW50KGNhcmREYXRhKTtcbiAgICAgICAgY2FyZExpc3QuYXBwZW5kKGNhcmRFbCk7XG4gICAgICB9KTtcblxuICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VySW5mby5uYW1lO1xuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gdXNlckluZm8uYWJvdXQ7XG4gICAgICBhdmF0YXJJbWFnZUVsLnNyYyA9IHVzZXJJbmZvLmF2YXRhcjtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbn1cblxuZW5hYmxlVmFsaWRhdGlvbihmb3JtVmFsaWRhdGlvbkNvbmZpZyk7XG5zZXRNb2RhbENsb3NlQnRuTGlzdGVuZXJzKCk7XG5zZXRNb2RhbE92ZXJsYXlDbG9zZUxpc3RlbmVycygpO1xuZ2V0SW5pdGlhbERhdGEoKTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB0aGlzLl9jdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSk7XG4gIH1cblxuICBhZGRQb3N0KHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICB9XG5cbiAgY2hhbmdlTGlrZVN0YXR1cyhpZCwgaXNMaWtlZCkge1xuICAgIHJldHVybiB0aGlzLl9jdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGFib3V0LFxuICAgICAgfSksXG4gICAgfSk7XG4gIH1cblxuICBlZGl0VXNlckF2YXRhcihhdmF0YXIpIHtcbiAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIF9jdXN0b21GZXRjaCh1cmwsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4gZmV0Y2godXJsLCBvcHRpb25zKS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbImZvcm1WYWxpZGF0aW9uQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ0blNlbGVjdG9yIiwiZXJyb3JTZWxlY3RvciIsImlucHV0VHlwZUVycm9yQ2xhc3MiLCJlcnJvckFjdGl2ZUNsYXNzIiwiaW5hY3RpdmVTdWJtaXRCdG5DbGFzcyIsInVwZGF0ZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWwiLCJjb25maWciLCJBcnJheSIsImZyb20iLCJzb21lIiwiaW5wdXRFbCIsInZhbGlkaXR5IiwidmFsaWQiLCJkaXNhYmxlQnV0dG9uIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiZGlzYWJsZWQiLCJlbmFibGVCdXR0b24iLCJoaWRlSW5wdXRFcnJvciIsImVycm9yRWwiLCJwYXJlbnRFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImFkZCIsInNldEJ0blRleHQiLCJidG4iLCJpc0xvYWRpbmciLCJkZWZhdWx0VGV4dCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImxvYWRpbmdUZXh0IiwidGV4dENvbnRlbnQiLCJzZWxlY3RlZENhcmRFbCIsInNlbGVjdGVkQ2FyZElkIiwiYXBpIiwiY29uc3RydWN0b3IiLCJfcmVmIiwiYmFzZVVybCIsImhlYWRlcnMiLCJ0aGlzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsImdldEFwcEluZm8iLCJQcm9taXNlIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiZ2V0VXNlckluZm8iLCJfY3VzdG9tRmV0Y2giLCJhZGRQb3N0IiwiX3JlZjIiLCJuYW1lIiwibGluayIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZGVsZXRlQ2FyZCIsImlkIiwiY2hhbmdlTGlrZVN0YXR1cyIsImlzTGlrZWQiLCJlZGl0VXNlckluZm8iLCJfcmVmMyIsImFib3V0IiwiZWRpdFVzZXJBdmF0YXIiLCJhdmF0YXIiLCJ1cmwiLCJvcHRpb25zIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwicmVqZWN0Iiwic3RhdHVzIiwiYXV0aG9yaXphdGlvbiIsImF2YXRhckltYWdlRWwiLCJkb2N1bWVudCIsImVkaXRQcm9maWxlTW9kYWwiLCJlZGl0QXZhdGFyTW9kYWwiLCJhdmF0YXJFbCIsInByb2ZpbGVBdmF0YXJCdG4iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsInByb2ZpbGVOYW1lSW5wdXQiLCJwcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsInByb2ZpbGVFZGl0QnRuIiwicHJvZmlsZUVkaXRGb3JtIiwiZm9ybXMiLCJwcm9maWxlQXZhdGFyRm9ybSIsImFkZEV2ZW50TGlzdGVuZXIiLCJvcGVuTW9kYWwiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsInNhdmVCdG5FbCIsInN1Ym1pdHRlciIsInRhcmdldCIsImVsZW1lbnRzIiwidmFsdWUiLCJkYXRhIiwic3JjIiwiY2xvc2VNb2RhbCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZmluYWxseSIsImZvckVhY2giLCJuZXdQb3N0TW9kYWwiLCJuZXdQb3N0QnRuIiwibmV3UG9zdEZvcm0iLCJwb3N0U3VibWl0QnRuIiwiYWRkUG9zdEJ0bkVsIiwiY2FyZERhdGEiLCJjYXJkRWwiLCJnZXRDYXJkRWxlbWVudCIsImNhcmRMaXN0IiwicHJlcGVuZCIsInJlc2V0IiwiZGVsZXRlUG9zdE1vZGFsIiwiZGVsZXRlUG9zdEZvcm0iLCJzdWJtaXREZWxldGVCdG4iLCJwcmV2aWV3TW9kYWwiLCJwcmV2aWV3SW1hZ2VFbCIsImNhcHRpb25FbCIsIm1vZGFscyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJtb2RhbCIsImNsb3NlTW9kYWxPbkVzY2FwZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJrZXkiLCJfaWQiLCJjYXJkRWxlbWVudCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJjYXJkTmFtZUVsIiwiY2FyZEltYWdlRWwiLCJjYXJkTGlrZUJ0biIsImNhcmREZWxldGVCdG4iLCJzZXRBdHRyaWJ1dGUiLCJjb250YWlucyIsInRvZ2dsZSIsImZvcm1FbCIsInZhbGlkYXRpb25NZXNzYWdlIiwic2hvd0lucHV0RXJyb3IiLCJ0b2dnbGVJbnB1dEVycm9yIiwic2V0VmFsaWRhdGlvbk9uRXZlbnQiLCJidXR0b24iLCJjbG9zZXN0IiwiY2FyZHMiLCJ1c2VySW5mbyIsImFwcGVuZCJdLCJzb3VyY2VSb290IjoiIn0=